<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SimLife 3D | Babylon.js Portfolio</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;900&display=swap" rel="stylesheet">

    <!-- Babylon.js Core & GUI -->
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>

    <!-- GSAP for UI Animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        :root {
            --sim-green: #66cc33;
            --sim-green-dark: #4da11e;
            --sim-blue: #00a8e8;
            --sim-dark: #272727;
            --glass-bg: rgba(255, 255, 255, 0.85);
            --font-main: 'Nunito', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            background-color: #dbeaff;
            overflow: hidden;
            /* Canvas handles background */
            height: 100vh;
            width: 100vw;
            color: var(--sim-dark);
        }

        /* CANVAS LAYER */
        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
            outline: none;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }

        /* UI OVERLAY */
        #ui-layer {
            position: relative;
            z-index: 10;
            height: 100%;
            display: flex;
            flex-direction: column;
            pointer-events: none;
            /* Let clicks pass to 3D world */
        }

        .interactive {
            pointer-events: auto;
        }

        /* HEADER */
        .sim-header {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border-bottom: 4px solid var(--sim-green);
            padding: 20px 40px;
            display: flex;
            align-items: center;
            gap: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transform: translateY(-100%);
            animation: slideDown 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards 0.5s;
        }

        .avatar-3d {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            border: 4px solid var(--sim-green);
            background: #fff;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 0 4px rgba(102, 204, 51, 0.2);
            font-size: 2.5rem;
            /* Emoji fallback */
        }

        .header-info h1 {
            font-size: 2rem;
            text-transform: uppercase;
            color: var(--sim-dark);
            margin-bottom: 4px;
        }

        .header-info p {
            color: var(--sim-blue);
            font-weight: 700;
            font-size: 1.1rem;
        }

        /* MAIN CONTENT */
        .sim-body {
            flex: 1;
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 25px;
            padding: 30px 40px;
            overflow: hidden;
        }

        /* SIDEBAR */
        .sim-sidebar {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            transform: translateX(-50px);
            opacity: 0;
            animation: fadeInLeft 0.8s ease forwards 0.8s;
        }

        /* MAIN PANEL */
        .sim-main {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            transform: translateY(50px);
            opacity: 0;
            animation: fadeInUp 0.8s ease forwards 1s;
        }

        /* TYPOGRAPHY & UI ELEMENTS */
        h2 {
            font-size: 1.4rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid #eee;
            padding-bottom: 8px;
        }

        h2::before {
            content: '';
            width: 5px;
            height: 20px;
            background: var(--sim-green);
            border-radius: 3px;
        }

        p {
            line-height: 1.7;
            color: #555;
            margin-bottom: 15px;
        }

        /* 3D UI CARD */
        .info-card-3d {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 12px;
            border-left: 4px solid var(--sim-blue);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .info-card-3d:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* SIMS STYLE NEED BARS */
        .skill-row {
            margin-bottom: 18px;
        }

        .skill-meta {
            display: flex;
            justify-content: space-between;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .bar-track {
            height: 12px;
            background: #eee;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .bar-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--sim-green), #8cd642);
            transition: width 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }

        .bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.4), transparent);
        }

        /* JOB CARD */
        .job-card {
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 20px;
            background: linear-gradient(135deg, #fff 0%, #fafafa 100%);
            margin-bottom: 20px;
        }

        .job-role {
            color: var(--sim-dark);
            font-weight: 800;
            font-size: 1.2rem;
        }

        .job-company {
            color: var(--sim-blue);
            font-weight: 600;
            margin-bottom: 10px;
        }

        /* BOTTOM NAV */
        .sim-nav {
            background: var(--sim-dark);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            gap: 30px;
            border-top: 4px solid var(--sim-green);
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.2);
        }

        .nav-btn {
            background: none;
            border: none;
            color: #aaa;
            font-family: var(--font-main);
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .nav-btn span {
            font-size: 1.5rem;
            display: block;
        }

        .nav-btn:hover,
        .nav-btn.active {
            color: var(--sim-green);
            transform: translateY(-5px);
        }

        /* LOADING SCREEN */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--sim-dark);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
        }

        .plumbob-3d {
            width: 80px;
            height: 110px;
            animation: spinBob 2s infinite linear;
            filter: drop-shadow(0 0 20px var(--sim-green));
        }

        .loader-text {
            margin-top: 20px;
            font-weight: 700;
            letter-spacing: 2px;
            color: var(--sim-green);
        }

        @keyframes slideDown {
            to {
                transform: translateY(0);
            }
        }

        @keyframes fadeInLeft {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spinBob {
            0% {
                transform: translateY(0) rotate(0deg);
            }

            50% {
                transform: translateY(-10px) rotate(5deg);
            }

            100% {
                transform: translateY(0) rotate(0deg);
            }
        }

        @media (max-width: 768px) {
            .sim-body {
                grid-template-columns: 1fr;
                padding: 15px;
                overflow-y: auto;
            }

            .sim-sidebar {
                max-height: 300px;
            }

            .sim-main {
                overflow-y: visible;
            }

            .sim-header {
                padding: 15px;
            }

            .avatar-3d {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }

            #ui-layer {
                overflow-y: auto;
            }

            /* Allow body scroll on mobile */
        }
    </style>
</head>

<body>

    <!-- LOADING SCREEN -->
    <div id="loading-screen">
        <svg class="plumbob-3d" viewBox="0 0 100 130">
            <defs>
                <linearGradient id="bobGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#8cd642" />
                    <stop offset="100%" stop-color="#66cc33" />
                </linearGradient>
            </defs>
            <polygon points="50,0 100,60 50,130 0,60" fill="url(#bobGrad)" />
        </svg>
        <div class="loader-text">GENERATING 3D WORLD...</div>
    </div>

    <!-- 3D CANVAS -->
    <canvas id="renderCanvas"></canvas>

    <!-- UI LAYER -->
    <div id="ui-layer">
        <header class="sim-header interactive">
            <div class="avatar-3d" id="avatar-icon">ðŸ‘¤</div>
            <div class="header-info">
                <h1 id="profile-name">Sim Name</h1>
                <p id="profile-title">Loading Title...</p>
            </div>
        </header>

        <div class="sim-body">
            <aside class="sim-sidebar interactive">
                <h2>Simology</h2>
                <div id="education-container"></div>

                <h2 style="margin-top: 30px;">Contact</h2>
                <div id="contact-container"></div>

                <h2 style="margin-top: 30px;">Aspiration</h2>
                <div id="aspiration-container"></div>
            </aside>

            <main class="sim-main interactive">
                <section id="about">
                    <h2>Biography</h2>
                    <p id="bio-text">Loading data from the cloud...</p>
                </section>

                <section id="career" style="margin-top: 40px;">
                    <h2>Career History</h2>
                    <div id="career-list"></div>
                </section>

                <section id="projects" style="margin-top: 40px;">
                    <h2>Skills & Projects</h2>
                    <div id="skills-list"></div>
                </section>
                <div style="height: 50px;"></div>
            </main>
        </div>

        <nav class="sim-nav interactive">
            <button class="nav-btn active" onclick="navTo('about', this)"><span>ðŸ‘¤</span>About</button>
            <button class="nav-btn" onclick="navTo('career', this)"><span>ðŸ’¼</span>Career</button>
            <button class="nav-btn" onclick="navTo('projects', this)"><span>ðŸŽ¨</span>Skills</button>
            <button class="nav-btn" onclick="navTo('contact', this)"><span>ðŸ“ž</span>Social</button>
        </nav>
    </div>

    <!-- FIREBASE + LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // --- FIREBASE CONFIG (PLACEHOLDER) ---
        const firebaseConfig = {
            apiKey: "AIzaSyDxqQOEuFjIR2W9-lrtAjaYsqPMHa8-6X4",
            authDomain: "jimmy-27ea1.firebaseapp.com",
            databaseURL: "https://jimmy-27ea1.firebaseio.com",
            projectId: "jimmy-27ea1",
            storageBucket: "jimmy-27ea1.appspot.com",
            messagingSenderId: "1053115589398",
            appId: "1:1053115589398:web:f8f300891ea3c2d81be637",
            measurementId: "G-0VV0WP7VZ3"
        };

        let db;
        try {
            if (firebaseConfig.apiKey !== "ISI_API_KEY_ANDA_DISINI") {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                window.firebaseDb = db;
            }
        } catch (e) { console.warn("Firebase init failed. Using dummy."); }

        // --- BABYLON.JS SCENE SETUP ---
        const canvas = document.getElementById("renderCanvas");
        const engine = new BABYLON.Engine(canvas, true);

        const createScene = function () {
            const scene = new BABYLON.Scene(engine);
            scene.clearColor = new BABYLON.Color4(0.8, 0.9, 1, 1); // Sims 4 Sky Blue

            // 1. CAMERA
            const camera = new BABYLON.ArcRotateCamera("camera", -Math.PI / 2, Math.PI / 2.5, 8, new BABYLON.Vector3(0, 1, 0), scene);
            camera.attachControl(canvas, true);
            camera.wheelPrecision = 50;
            camera.lowerRadiusLimit = 5;
            camera.upperRadiusLimit = 15;
            camera.upperBetaLimit = Math.PI / 2 - 0.1; // Don't go below ground

            // 2. LIGHTING
            const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);
            light.intensity = 0.8;
            const dirLight = new BABYLON.DirectionalLight("dirLight", new BABYLON.Vector3(-1, -2, -1), scene);
            dirLight.position = new BABYLON.Vector3(20, 40, 20);
            dirLight.intensity = 0.6;

            // 3. PROCEDURAL SIM CHARACTER (Mesh Construction)
            const simRoot = new BABYLON.TransformNode("simRoot", scene);

            // Body Material
            const bodyMat = new BABYLON.StandardMaterial("bodyMat", scene);
            bodyMat.diffuseColor = new BABYLON.Color3(0.8, 0.2, 0.2); // Red Shirt

            // Skin Material
            const skinMat = new BABYLON.StandardMaterial("skinMat", scene);
            skinMat.diffuseColor = new BABYLON.Color3(1, 0.9, 0.8);

            // Head
            const head = BABYLON.MeshBuilder.CreateCylinder("head", { diameter: 0.6, height: 0.75 }, scene);
            head.material = skinMat;
            head.position.y = 1.8;
            head.parent = simRoot;

            // Torso
            const torso = BABYLON.MeshBuilder.CreateBox("torso", { width: 0.8, height: 1, depth: 0.5 }, scene);
            torso.material = bodyMat;
            torso.position.y = 1.1;
            torso.parent = simRoot;

            // Arms
            const armGeo = { width: 0.2, height: 0.8, depth: 0.2 };
            const leftArm = BABYLON.MeshBuilder.CreateBox("lArm", armGeo, scene);
            leftArm.material = bodyMat;
            leftArm.position = new BABYLON.Vector3(-0.55, 1.1, 0);
            leftArm.parent = simRoot;

            const rightArm = BABYLON.MeshBuilder.CreateBox("rArm", armGeo, scene);
            rightArm.material = bodyMat;
            rightArm.position = new BABYLON.Vector3(0.55, 1.1, 0);
            rightArm.parent = simRoot;

            // Legs
            const legGeo = { width: 0.3, height: 0.8, depth: 0.3 };
            const leftLeg = BABYLON.MeshBuilder.CreateBox("lLeg", legGeo, scene);
            leftLeg.material = new BABYLON.StandardMaterial("pantsMat", scene); // Blue pants
            leftLeg.material.diffuseColor = new BABYLON.Color3(0.2, 0.4, 0.8);
            leftLeg.position = new BABYLON.Vector3(-0.2, 0.3, 0);
            leftLeg.parent = simRoot;

            const rightLeg = BABYLON.MeshBuilder.CreateBox("rLeg", legGeo, scene);
            rightLeg.material = leftLeg.material;
            rightLeg.position = new BABYLON.Vector3(0.2, 0.3, 0);
            rightLeg.parent = simRoot;

            // 4. THE PLUMBOB (Floating Diamond)
            const plumbobMat = new BABYLON.StandardMaterial("plumbobMat", scene);
            plumbobMat.diffuseColor = new BABYLON.Color3(0.4, 0.8, 0.2);
            plumbobMat.emissiveColor = new BABYLON.Color3(0.1, 0.2, 0.05);

            const plumbob = BABYLON.MeshBuilder.CreatePolyhedron("plumbob", { type: 2, size: 0.2 }, scene); // Diamond shape
            plumbob.material = plumbobMat;
            plumbob.position.y = 2.5;
            plumbob.parent = simRoot;

            // Animate Plumbob Float
            const frameRate = 10;
            const ySlide = new BABYLON.Animation("ySlide", "position.y", frameRate, BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE);
            const keyFrames = [];
            keyFrames.push({ frame: 0, value: 2.5 });
            keyFrames.push({ frame: frameRate, value: 2.7 });
            keyFrames.push({ frame: frameRate * 2, value: 2.5 });
            ySlide.setKeys(keyFrames);
            plumbob.animations.push(ySlide);
            scene.beginAnimation(plumbob, 0, frameRate * 2, true);

            // Animate Sim Idle (Breathing)
            const breathAnim = new BABYLON.Animation("breath", "scaling.y", 30, BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE);
            const breathKeys = [];
            breathKeys.push({ frame: 0, value: 1 });
            breathKeys.push({ frame: 60, value: 1.02 });
            breathKeys.push({ frame: 120, value: 1 });
            breathAnim.setKeys(breathKeys);
            simRoot.animations.push(breathAnim);
            scene.beginAnimation(simRoot, 0, 120, true);

            // 5. ENVIRONMENT (Grid Floor)
            const ground = BABYLON.MeshBuilder.CreateGround("ground", { width: 50, height: 50, subdivisions: 20 }, scene);
            const gridMat = new BABYLON.StandardMaterial("gridMat", scene);
            gridMat.wireframe = true;
            gridMat.emissiveColor = new BABYLON.Color3(0.8, 0.9, 1);
            ground.material = gridMat;
            ground.position.y = -0.1;

            // 6. INTERACTION: MOUSE FOLLOW
            scene.onBeforeRenderObservable.add(() => {
                // Simple lookAt logic towards camera or mouse ray
                const ray = scene.createPickingRay(scene.pointerX, scene.pointerY, BABYLON.Matrix.Identity(), camera);
                const hit = scene.pickWithRay(ray, (mesh) => mesh === ground);

                if (hit.pickedPoint) {
                    // Smoothly rotate Sim to look at the mouse point
                    const lookAtTarget = BABYLON.Vector3.Zero();
                    lookAtTarget.x = hit.pickedPoint.x;
                    // Keep Y zero so it doesn't look up/down weirdly
                    simRoot.lookAt(lookAtTarget);
                }
            });

            return scene;
        };

        const scene = createScene();

        engine.runRenderLoop(function () {
            scene.render();
        });

        window.addEventListener("resize", function () {
            engine.resize();
        });

        // --- FIREBASE DATA LOGIC ---

        // Dummy Data Fallback
        const dummyData = {
            name: "Sim 3D",
            title: "Full Stack Developer",
            bio: "I am a 3D interactive portfolio. Built with Babylon.js and styled like The Sims 4. I love WebGL and creative coding.",
            image: "ðŸ‘¤", // Emoji for UI
            contact: {
                email: "dev@babylon.sim",
                phone: "+62 888 999",
                location: "SimCity, Oasis Springs",
                linkedin: "linkedin.com/in/sim3d"
            },
            education: {
                school: "Simstitute of Technology",
                degree: "Master of Computer Science",
                aspiration: "Computer Whiz"
            },
            career: [
                { role: "Lead 3D Developer", company: "Plumbob Studios", date: "2023 - Present" },
                { role: "Frontend Engineer", company: "Electronic Artsy", date: "2021 - 2023" }
            ],
            skills: [
                { name: "Babylon.js", level: 90 },
                { name: "JavaScript", level: 95 },
                { name: "React", level: 85 },
                { name: "Three.js", level: 70 }
            ]
        };

        async function getData() {
            if (window.firebaseDb) {
                try {
                    const docRef = doc(window.firebaseDb, "cv_data", "main_profile");
                    const docSnap = await getDoc(docRef);
                    if (docSnap.exists()) return docSnap.data();
                } catch (e) { console.error(e); }
            }
            return dummyData;
        }

        // --- UI POPULATION ---
        async function initApp() {
            const data = await getData();

            // 1. Header
            document.getElementById('profile-name').innerText = data.name;
            document.getElementById('profile-title').innerText = data.title;
            document.getElementById('bio-text').innerText = data.bio;
            document.getElementById('avatar-icon').innerText = data.image || "ðŸ‘¤";

            // 2. Sidebar (Education)
            if (data.education) {
                document.getElementById('education-container').innerHTML = `
                <div class="info-card-3d">
                    <div style="font-size:1.5rem;">ðŸŽ“</div>
                    <div>
                        <div style="font-weight:800;">${data.education.school}</div>
                        <div style="font-size:0.85rem; color:#666;">${data.education.degree}</div>
                    </div>
                </div>
            `;
                document.getElementById('aspiration-container').innerHTML = `
                <div class="info-card-3d" style="border-color: var(--sim-green);">
                    <div style="font-size:1.5rem;">âœ¨</div>
                    <div>
                        <div style="font-size:0.8rem; font-weight:800; text-transform:uppercase;">Aspiration</div>
                        <div style="font-weight:700; color:var(--sim-green);">${data.education.aspiration}</div>
                    </div>
                </div>
            `;
            }

            // 3. Contact
            if (data.contact) {
                const list = document.getElementById('contact-container');
                const items = [
                    { icon: 'ðŸ“§', val: data.contact.email },
                    { icon: 'ðŸ“±', val: data.contact.phone },
                    { icon: 'ðŸ“', val: data.contact.location },
                    { icon: 'ðŸ”—', val: data.contact.linkedin }
                ];
                list.innerHTML = items.map(i => i.val ? `
                <div class="info-card-3d" style="border-left: none; background:white;">
                    <div>${i.icon}</div>
                    <div style="font-size:0.9rem; word-break:break-all;">${i.val}</div>
                </div>
            ` : '').join('');
            }

            // 4. Career
            if (data.career) {
                document.getElementById('career-list').innerHTML = data.career.map(c => `
                <div class="job-card">
                    <div class="job-role">${c.role}</div>
                    <div class="job-company">@ ${c.company}</div>
                    <div style="font-size:0.85rem; color:#888;">${c.date}</div>
                </div>
            `).join('');
            }

            // 5. Skills
            if (data.skills) {
                document.getElementById('skills-list').innerHTML = data.skills.map(s => `
                <div class="skill-row">
                    <div class="skill-meta">
                        <span>${s.name}</span>
                        <span>Lvl ${s.level}</span>
                    </div>
                    <div class="bar-track">
                        <div class="bar-fill" style="width: 0%" data-width="${s.level}%"></div>
                    </div>
                </div>
            `).join('');
                setTimeout(() => {
                    document.querySelectorAll('.bar-fill').forEach(bar => bar.style.width = bar.dataset.width);
                }, 500);
            }

            // Remove Loader
            document.getElementById('loading-screen').style.opacity = 0;
            setTimeout(() => document.getElementById('loading-screen').remove(), 500);
        }

        // Expose nav function
        window.navTo = function (id, btn) {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const target = document.getElementById(id === 'contact' ? 'contact-container' : id);
            if (target) target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        initApp();
    </script>
</body>

</html>